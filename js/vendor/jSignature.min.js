/*
 
jSignature v2 "2013-08-12T06:50" "commit ID 1290a44617bc3f9705883a8c9cc83bb533cdc843"
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 jSignature's Undo Button and undo functionality plugin


jSignature v2 jSignature's custom "base30" format export and import plugins.


jSignature v2 SVG export plugin.


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js

*/
(function(){function p(b){var a,e=b.css("color"),d;b=b[0];for(var c=!1;b&&!d&&!c;){try{a=$(b).css("background-color")}catch(B){a="transparent"}"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(d=a);c=b.body;b=b.parentNode}b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/;var c=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,h;a=void 0;(a=e.match(b))?h={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=e.match(c))&&(h={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)});var l;
d?(a=void 0,(a=d.match(b))?l={r:parseInt(a[1],10),g:parseInt(a[2],10),b:parseInt(a[3],10)}:(a=d.match(c))&&(l={r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)})):l=h?127<Math.max.apply(null,[h.r,h.g,h.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};a=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+")"};h&&l?(b=Math.max.apply(null,[h.r,h.g,h.b]),h=Math.max.apply(null,[l.r,l.g,l.b]),h=Math.round(h+-0.75*(h-b)),h={r:h,g:h,b:h}):h?(h=Math.max.apply(null,[h.r,h.g,h.b]),b=1,127<
h&&(b=-1),h=Math.round(h+96*b),h={r:h,g:h,b:h}):h={r:191,g:191,b:191};return{color:e,"background-color":l?a(l):d,"decor-color":a(h)}}function m(b,a){this.x=b;this.y=a;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var e=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=
0;else if(0===this.x)this._length=a,this.y=a*e(this.y);else if(0===this.y)this._length=a,this.x=a*e(this.x);else{var b=Math.abs(this.y/this.x),c=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2))),b=b*c;this._length=a;this.x=c*e(this.x);this.y=b*e(this.y)}return this};this.angleTo=function(a){var b=this.getLength()*a.getLength();return 0===b?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/b,-1),1))/Math.PI}}function g(b,a){this.x=b;this.y=a;this.getVectorToCoordinates=function(a,b){return new m(a-this.x,
b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new m(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function q(b,a,e,d,c){this.data=b;this.context=a;if(b.length)for(var B=b.length,h,l,f=0;f<B;f++){h=b[f];l=h.x.length;e.call(a,h);for(var C=1;C<l;C++)d.call(a,h,C);c.call(a,h)}this.changed=function(){};this.startStrokeFn=e;this.addToStrokeFn=d;this.endStrokeFn=
c;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(a){if(a&&"number"==typeof a.x&&"number"==typeof a.y){this._stroke={x:[a.x],y:[a.y]};this.data.push(this._stroke);this._lastPoint=a;this.inStroke=!0;var b=this._stroke,e=this.startStrokeFn,d=this.context;setTimeout(function(){e.call(d,b)},3);return a}return null};this.addToStroke=function(a){if(this.inStroke&&"number"===typeof a.x&&"number"===typeof a.y&&4<Math.abs(a.x-this._lastPoint.x)+Math.abs(a.y-this._lastPoint.y)){var b=
this._stroke.x.length;this._stroke.x.push(a.x);this._stroke.y.push(a.y);this._lastPoint=a;var e=this._stroke,d=this.addToStrokeFn,c=this.context;setTimeout(function(){d.call(c,e,b)},3);return a}return null};this.endStroke=function(){var a=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(a){var b=this._stroke,e=this.endStrokeFn,d=this.context,c=this.changed;setTimeout(function(){e.call(d,b);c.call(d)},3);return!0}return null}}function n(b,a,e,d){if("ratio"===a||"%"===a.split("")[a.length-1])this.eventTokens[e+
".parentresized"]=d.subscribe(e+".parentresized",function(a,c,h,f){return function(){var f=c.width();if(f!==h){for(var l in a)a.hasOwnProperty(l)&&(d.unsubscribe(a[l]),delete a[l]);var w=b.settings;b.$parent.children().remove();for(l in b)b.hasOwnProperty(l)&&delete b[l];l=w.data;var f=1*f/h,x=[],k,g,m,n,q,p;g=0;for(m=l.length;g<m;g++){p=l[g];k={x:[],y:[]};n=0;for(q=p.x.length;n<q;n++)k.x.push(p.x[n]*f),k.y.push(p.y[n]*f);x.push(k)}w.data=x;c[e](w)}}}(this.eventTokens,this.$parent,this.$parent.width(),
1*this.canvas.width/this.canvas.height))}function z(b,a,e){var d=this.$parent=$(b);b=this.eventTokens={};this.events=new t(this);var c=$.fn[k]("globalEvents"),f={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,readOnly:!1,data:[]};$.extend(f,p(d));a&&$.extend(f,a);this.settings=f;for(var h in e)e.hasOwnProperty(h)&&e[h].call(this,h);this.events.publish(k+".initializing");this.$controlbarUpper=
$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none;margin-top:-1em !important; margin-bottom:1em !important;"></div>').appendTo(d);this.isCanvasEmulator=!1;a=this.canvas=this.initializeCanvas(f);e=$(a);this.$controlbarLower=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none;margin-top:-1.5em !important; margin-bottom:1.5em !important;"></div>').appendTo(d);
this.canvasContext=a.getContext("2d");e.data(k+".this",this);f.lineWidth=f.lineWidth?f.lineWidth:Math.max(Math.round(a.width/400),2);this.lineCurveThreshold=3*f.lineWidth;f.cssclass&&""!=$.trim(f.cssclass)&&e.addClass(f.cssclass);this.fatFingerCompensation=0;d=function(a){var b,e,d=function(d){d=d.changedTouches&&0<d.changedTouches.length?d.changedTouches[0]:d;return new g(Math.round(d.pageX+b),Math.round(d.pageY+e)+a.fatFingerCompensation)},c=new s(750,function(){a.dataEngine.endStroke()});this.drawEndHandler=
function(b){if(!a.settings.readOnly){try{b.preventDefault()}catch(e){}c.clear();a.dataEngine.endStroke()}};this.drawStartHandler=function(h){if(!a.settings.readOnly){h.preventDefault();var f=$(a.canvas).offset();b=-1*f.left;e=-1*f.top;a.dataEngine.startStroke(d(h));c.kick()}};this.drawMoveHandler=function(b){a.settings.readOnly||(b.preventDefault(),a.dataEngine.inStroke&&(a.dataEngine.addToStroke(d(b)),c.kick()))};return this}.call({},this);(function(a,b,e){var d=this.canvas,c=$(d);this.isCanvasEmulator?
(c.bind("mousemove."+k,e),c.bind("mouseup."+k,a),c.bind("mousedown."+k,b)):(d.ontouchstart=function(c){d.onmousedown=void 0;d.onmouseup=void 0;d.onmousemove=void 0;this.fatFingerCompensation=f.minFatFingerCompensation&&-3*f.lineWidth>f.minFatFingerCompensation?-3*f.lineWidth:f.minFatFingerCompensation;b(c);d.ontouchend=a;d.ontouchstart=b;d.ontouchmove=e},d.onmousedown=function(c){d.ontouchstart=void 0;d.ontouchend=void 0;d.ontouchmove=void 0;b(c);d.onmousedown=b;d.onmouseup=a;d.onmousemove=e},window.navigator.msPointerEnabled&&
(d.onmspointerdown=b,d.onmspointerup=a,d.onmspointermove=e))}).call(this,d.drawEndHandler,d.drawStartHandler,d.drawMoveHandler);b[k+".windowmouseup"]=c.subscribe(k+".windowmouseup",d.drawEndHandler);this.events.publish(k+".attachingEventHandlers");n.call(this,this,f.width.toString(10),k,c);this.resetCanvas(f.data);this.events.publish(k+".initialized");return this}function r(b){if(b.getContext)return!1;var a=b.ownerDocument.parentWindow,e=a.FlashCanvas?b.ownerDocument.parentWindow.FlashCanvas:"undefined"===
typeof FlashCanvas?void 0:FlashCanvas;if(e){b=e.initElement(b);e=1;a&&(a.screen&&a.screen.deviceXDPI&&a.screen.logicalXDPI)&&(e=1*a.screen.deviceXDPI/a.screen.logicalXDPI);if(1!==e)try{$(b).children("object").get(0).resize(Math.ceil(b.width*e),Math.ceil(b.height*e)),b.getContext("2d").scale(e,e)}catch(d){}return!0}throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");}var k="jSignature",s=function(b,a){var e;this.kick=function(){clearTimeout(e);e=setTimeout(a,b)};this.clear=
function(){clearTimeout(e)};return this},t=function(b){this.topics={};this.context=b?b:this;this.publish=function(a,b,d,c){if(this.topics[a]){var f=this.topics[a],h=Array.prototype.slice.call(arguments,1),l=[],k,g,w,x;g=0;for(w=f.length;g<w;g++)x=f[g],k=x[0],x[1]&&(x[0]=function(){},l.push(g)),k.apply(this.context,h);g=0;for(w=l.length;g<w;g++)f.splice(l[g],1)}};this.subscribe=function(a,b,d){this.topics[a]?this.topics[a].push([b,d]):this.topics[a]=[[b,d]];return{topic:a,callback:b}};this.unsubscribe=
function(a){if(this.topics[a.topic])for(var b=this.topics[a.topic],d=0,c=b.length;d<c;d++)b[d]&&b[d][0]===a.callback&&b.splice(d,1)}},u=function(b,a,e,d,c){b.beginPath();b.moveTo(a,e);b.lineTo(d,c);b.stroke()},v=function(b){var a=this.canvasContext,e=b.x[0];b=b.y[0];var d=this.settings.lineWidth,c=a.fillStyle;a.fillStyle=a.strokeStyle;a.fillRect(e+d/-2,b+d/-2,d,d);a.fillStyle=c},c=function(b,a){var e=new g(b.x[a-1],b.y[a-1]),d=new g(b.x[a],b.y[a]),c=e.getVectorToPoint(d);if(1<a){var f=new g(b.x[a-
2],b.y[a-2]),h=f.getVectorToPoint(e),l;if(h.getLength()>this.lineCurveThreshold){l=2<a?(new g(b.x[a-3],b.y[a-3])).getVectorToPoint(f):new m(0,0);var k=0.35*h.getLength(),n=h.angleTo(l.reverse()),w=c.angleTo(h.reverse());l=(new m(l.x+h.x,l.y+h.y)).resizeTo(Math.max(0.05,n)*k);var x=(new m(h.x+c.x,h.y+c.y)).reverse().resizeTo(Math.max(0.05,w)*k),h=this.canvasContext,k=f.x,w=f.y,n=e.x,q=e.y,p=f.x+l.x,f=f.y+l.y;l=e.x+x.x;x=e.y+x.y;h.beginPath();h.moveTo(k,w);h.bezierCurveTo(p,f,l,x,n,q);h.stroke()}}c.getLength()<=
this.lineCurveThreshold&&u(this.canvasContext,e.x,e.y,d.x,d.y)},f=function(b){var a=b.x.length-1;if(0<a){var e=new g(b.x[a],b.y[a]),d=new g(b.x[a-1],b.y[a-1]),c=d.getVectorToPoint(e);if(c.getLength()>this.lineCurveThreshold)if(1<a){b=(new g(b.x[a-2],b.y[a-2])).getVectorToPoint(d);var f=(new m(b.x+c.x,b.y+c.y)).resizeTo(c.getLength()/2),c=this.canvasContext;b=d.x;var a=d.y,h=e.x,l=e.y,k=d.x+f.x,d=d.y+f.y,f=e.x,e=e.y;c.beginPath();c.moveTo(b,a);c.bezierCurveTo(k,d,f,e,h,l);c.stroke()}else u(this.canvasContext,
d.x,d.y,e.x,e.y)}};z.prototype.resetCanvas=function(b){var a=this.canvas,e=this.settings,d=this.canvasContext,g=this.isCanvasEmulator,B=a.width,h=a.height;d.clearRect(0,0,B+30,h+30);d.shadowColor=d.fillStyle=e["background-color"];g&&d.fillRect(0,0,B+30,h+30);d.lineWidth=Math.ceil(parseInt(e.lineWidth,10));d.lineCap=d.lineJoin="round";d.strokeStyle=e["decor-color"];d.shadowOffsetX=0;d.shadowOffsetY=0;var l=Math.round(h/5);u(d,1.5*l,h-l,B-1.5*l,h-l);d.strokeStyle=e.color;g||(d.shadowColor=d.strokeStyle,
d.shadowOffsetX=0.5*d.lineWidth,d.shadowOffsetY=-0.6*d.lineWidth,d.shadowBlur=0);b||(b=[]);d=this.dataEngine=new q(b,this,v,c,f);e.data=b;$(a).data(k+".data",b).data(k+".settings",e);d.changed=function(a,b,d){return function(){b.publish(d+".change");a.trigger("change")}}(this.$parent,this.events,k);d.changed();return!0};z.prototype.initializeCanvas=function(b){var a=document.createElement("canvas"),c=$(a);b.width===b.height&&"ratio"===b.height&&(b.width="100%");c.css("margin",0).css("padding",0).css("border",
"none").css("height","ratio"!==b.height&&b.height?b.height.toString(10):1).css("width","ratio"!==b.width&&b.width?b.width.toString(10):1).css("-ms-touch-action","none");c.appendTo(this.$parent);"ratio"===b.height?c.css("height",Math.round(c.width()/b.sizeRatio)):"ratio"===b.width&&c.css("width",Math.round(c.height()*b.sizeRatio));c.addClass(k);a.width=c.width();a.height=c.height();this.isCanvasEmulator=r(a);a.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();a&&a.stopPropagation&&
a.stopPropagation();return!1};return a};(function(b){function a(a,b,d){var c=new Image,e=this;c.onload=function(){e.getContext("2d").drawImage(c,0,0,c.width<e.width?c.width:e.width,c.height<e.height?c.height:e.height)};c.src="data:"+b+","+a}function c(a){this.find("canvas."+k).add(this.filter("canvas."+k)).data(k+".this").resetCanvas(a);return this}function d(a,b){if(void 0===b&&("string"===typeof a&&"data:"===a.substr(0,5))&&(b=a.slice(5).split(",")[0],a=a.slice(6+b.length),b===a))return;var c=this.find("canvas."+
k).add(this.filter("canvas."+k));if(l.hasOwnProperty(b))0!==c.length&&l[b].call(c[0],a,b,function(a){return function(){return a.resetCanvas.apply(a,arguments)}}(c.data(k+".this")));else throw Error(k+" is unable to find import plugin with for format '"+String(b)+"'");return this}var f=new t;(function(a,b,c,d){var e,f=function(){a.publish(b+".parentresized")};c(d).bind("resize."+b,function(){e&&clearTimeout(e);e=setTimeout(f,500)}).bind("mouseup."+b,function(c){a.publish(b+".windowmouseup")})})(f,
k,$,b);var g={},h={"default":function(a){return this.toDataURL()},"native":function(a){return a},image:function(a){a=this.toDataURL();if("string"===typeof a&&4<a.length&&"data:"===a.slice(0,5)&&-1!==a.indexOf(",")){var b=a.indexOf(",");return[a.slice(5,b),a.substr(b+1)]}return[]}},l={"native":function(a,b,c){c(a)},image:a,"image/png;base64":a,"image/jpeg;base64":a,"image/jpg;base64":a},n={"export":h,"import":l,instance:g},m={init:function(a){return this.each(function(){var b,c=!1;for(b=this.parentNode;b&&
!c;)c=b.body,b=b.parentNode;c&&new z(this,a,g)})},getSettings:function(){return this.find("canvas."+k).add(this.filter("canvas."+k)).data(k+".this").settings},clear:c,reset:c,addPlugin:function(a,b,c){n.hasOwnProperty(a)&&(n[a][b]=c);return this},listPlugins:function(a){var b=[];if(n.hasOwnProperty(a)){a=n[a];for(var c in a)a.hasOwnProperty(c)&&b.push(c)}return b},getData:function(a){var b=this.find("canvas."+k).add(this.filter("canvas."+k));void 0===a&&(a="default");if(0!==b.length&&h.hasOwnProperty(a))return h[a].call(b.get(0),
b.data(k+".data"))},importData:d,setData:d,globalEvents:function(){return f},disable:function(){this.find("input").attr("disabled",1);this.find("canvas."+k).addClass("disabled").data(k+".this").settings.readOnly=!0},enable:function(){this.find("input").removeAttr("disabled");this.find("canvas."+k).removeClass("disabled").data(k+".this").settings.readOnly=!1},events:function(){return this.find("canvas."+k).add(this.filter("canvas."+k)).data(k+".this").events}};$.fn[k]=function(a){if(a&&"object"!==
typeof a){if("string"===typeof a&&m[a])return m[a].apply(this,Array.prototype.slice.call(arguments,1));$.error("Method "+String(a)+" does not exist on jQuery."+k)}else return m.init.apply(this,arguments)}})(window)})();
(function(){function p(m,g,q){m=m.call(this);(function(g,m,q){g.events.subscribe(q+".change",function(){g.dataEngine.data.length?m.show():m.hide()})})(this,m,g);(function(g,m,q){var k=q+".undo";m.bind("click",function(){g.events.publish(k)});g.events.subscribe(k,function(){var k=g.dataEngine.data;k.length&&(k.pop(),g.resetCanvas(k))})})(this,m,this.events.topics.hasOwnProperty(g+".undo")?q:g)}$.fn.jSignature("addPlugin","instance","UndoButton",function(m){this.events.subscribe("jSignature.attachingEventHandlers",
function(){if(this.settings[m]){var g=this.settings[m];"function"!==typeof g&&(g=function(){var g=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),m=g.width();g.css("left",Math.round((this.canvas.width-m)/2));m!==g.width()&&g.width(m);return g});p.call(this,g,"jSignature",m)}})})})();
(function(){for(var p={},m={},g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),q=g.length/2,n=q-1;-1<n;n--)p[g[n]]=g[n+q],m[g[n+q]]=g[n];var z=function(c){c=c.split("");for(var f=c.length,b=1;b<f;b++)c[b]=p[c[b]];return c.join("")},r=function(c){for(var f=[],b=0,a=1,e=c.length,d,g,k=0;k<e;k++)d=Math.round(c[k]),g=d-b,b=d,0>g&&0<a?(a=-1,f.push("Z")):0<g&&0>a&&(a=1,f.push("Y")),d=Math.abs(g),d>=q?f.push(z(d.toString(q))):f.push(d.toString(q));return f.join("")},k=function(c){var f=
[];c=c.split("");for(var b=c.length,a,e=1,d=[],g=0,k=0;k<b;k++)a=c[k],a in p||"Z"===a||"Y"===a?(0!==d.length&&(d=parseInt(d.join(""),q)*e+g,f.push(d),g=d),"Z"===a?(e=-1,d=[]):"Y"===a?(e=1,d=[]):d=[a]):d.push(m[a]);f.push(parseInt(d.join(""),q)*e+g);return f},s=function(c){for(var f=[],b=c.length,a,e=0;e<b;e++)a=c[e],f.push(r(a.x)),f.push(r(a.y));return f.join("_")},t=function(c){var f=[];c=c.split("_");for(var b=c.length/2,a=0;a<b;a++)f.push({x:k(c[2*a]),y:k(c[2*a+1])});return f},u=function(c){return["image/jsignature;base30",
s(c)]},v=function(c,f,b){"string"===typeof c&&("image/jsignature;base30"===c.substring(0,23).toLowerCase()&&(c=c.substring(24)),b(t(c)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(c){c=c.fn.jSignature;c("addPlugin","export","base30",u);c("addPlugin","export","image/jsignature;base30",u);c("addPlugin","import","base30",v);c("addPlugin","import","image/jsignature;base30",v)})(this.jQuery);this.jSignatureDebug&&
(this.jSignatureDebug.base30={remapTailChars:z,compressstrokeleg:r,uncompressstrokeleg:k,compressstrokes:s,uncompressstrokes:t,charmap:p})}).call("undefined"!==typeof window?window:this);
(function(){function p(c,f){this.x=c;this.y=f;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var b=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*b(this.y);else if(0===this.y)this._length=a,this.x=a*b(this.x);else{var c=Math.abs(this.y/
this.x),d=Math.sqrt(Math.pow(a,2)/(1+Math.pow(c,2))),c=c*d;this._length=a;this.x=d*b(this.x);this.y=c*b(this.y)}return this};this.angleTo=function(a){var b=this.getLength()*a.getLength();return 0===b?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/b,-1),1))/Math.PI}}function m(c,f){this.x=c;this.y=f;this.getVectorToCoordinates=function(b,a){return new p(b-this.x,a-this.y)};this.getVectorFromCoordinates=function(b,a){return this.getVectorToCoordinates(b,a).reverse()};this.getVectorToPoint=function(b){return new p(b.x-
this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function g(c,f){var b=Math.pow(10,f);return Math.round(c*b)/b}function q(c,f,b){f+=1;var a=new m(c.x[f-1],c.y[f-1]),e=new m(c.x[f],c.y[f]),e=a.getVectorToPoint(e),d=new m(c.x[f-2],c.y[f-2]),a=d.getVectorToPoint(a);return a.getLength()>b?(b=2<f?(new m(c.x[f-3],c.y[f-3])).getVectorToPoint(d):new p(0,0),c=0.35*a.getLength(),d=a.angleTo(b.reverse()),f=e.angleTo(a.reverse()),b=(new p(b.x+a.x,b.y+a.y)).resizeTo(Math.max(0.05,
d)*c),e=(new p(a.x+e.x,a.y+e.y)).reverse().resizeTo(Math.max(0.05,f)*c),e=new p(a.x+e.x,a.y+e.y),["c",g(b.x,2),g(b.y,2),g(e.x,2),g(e.y,2),g(a.x,2),g(a.y,2)]):["l",g(a.x,2),g(a.y,2)]}function n(c,f){var b=c.x.length-1,a=new m(c.x[b],c.y[b]),e=new m(c.x[b-1],c.y[b-1]),a=e.getVectorToPoint(a);if(1<b&&a.getLength()>f){var b=(new m(c.x[b-2],c.y[b-2])).getVectorToPoint(e),e=a.angleTo(b.reverse()),d=0.35*a.getLength(),b=(new p(b.x+a.x,b.y+a.y)).resizeTo(Math.max(0.05,e)*d);return["c",g(b.x,2),g(b.y,2),g(a.x,
2),g(a.y,2),g(a.x,2),g(a.y,2)]}return["l",g(a.x,2),g(a.y,2)]}function z(c,f,b){f=["M",g(c.x[0]-f,2),g(c.y[0]-b,2)];b=1;for(var a=c.x.length-1;b<a;b++)f.push.apply(f,q(c,b,1));0<a?f.push.apply(f,n(c,b,1)):0===a&&f.push.apply(f,["l",1,1]);return f.join(" ")}function r(c){var f=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],b,a=c.length,e,d=[],g=[],k=e=b=0,h=0,l=[];if(0!==a){for(b=0;b<a;b++){k=
c[b];h=[];e={x:[],y:[]};for(var m=void 0,n=void 0,m=0,n=k.x.length;m<n;m++)h.push({x:k.x[m],y:k.y[m]});h=simplify(h,0.7,!0);m=0;for(n=h.length;m<n;m++)e.x.push(h[m].x),e.y.push(h[m].y);l.push(e);d=d.concat(e.x);g=g.concat(e.y)}c=Math.min.apply(null,d)-1;a=Math.max.apply(null,d)+1;d=Math.min.apply(null,g)-1;g=Math.max.apply(null,g)+1;k=0>c?0:c;h=0>d?0:d;b=a-c;e=g-d}f.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+b.toString()+'" height="'+e.toString()+'">');b=0;for(a=l.length;b<
a;b++)e=l[b],f.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+z(e,k,h)+'"/>');f.push("</svg>");return f.join("")}function k(c){return[u,r(c)]}function s(c){return[v,t(r(c))]}(function(c,f){"use strict";(typeof exports!=f+""?exports:c).simplify=function(b,a,c){a=a!==f?a*a:1;if(!c){var d=b.length,g,k=b[0],h=[k];for(c=1;c<d;c++){g=b[c];var l=g.x-k.x,m=g.y-k.y;l*l+m*m>a&&(h.push(g),k=g)}b=(k!==g&&h.push(g),h)}g=b;c=g.length;var d=new (typeof Uint8Array!=
f+""?Uint8Array:Array)(c),k=0,h=c-1,n,p,q=[],u=[],z=[];for(d[k]=d[h]=1;h;){m=0;for(l=k+1;l<h;l++){n=g[l];var y=g[k],t=g[h],r=y.x,s=y.y,y=t.x-r,A=t.y-s,v=void 0;if(0!==y||0!==A)v=((n.x-r)*y+(n.y-s)*A)/(y*y+A*A),1<v?(r=t.x,s=t.y):0<v&&(r+=y*v,s+=A*v);n=(y=n.x-r,A=n.y-s,y*y+A*A);n>m&&(p=l,m=n)}m>a&&(d[p]=1,q.push(k),u.push(p),q.push(p),u.push(h));k=q.pop();h=u.pop()}for(l=0;l<c;l++)d[l]&&z.push(g[l]);return b=z,b}})(window);if("function"!==typeof t)var t=function(c){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
b,a,e,d,g=0,k=0,h="",h=[];do b=c.charCodeAt(g++),a=c.charCodeAt(g++),e=c.charCodeAt(g++),d=b<<16|a<<8|e,b=d>>18&63,a=d>>12&63,e=d>>6&63,d&=63,h[k++]=f[b]+f[a]+f[e]+f[d];while(g<c.length);h=h.join("");c=c.length%3;return(c?h.slice(0,c-3):h)+"===".slice(c||3)};var u="image/svg+xml",v="image/svg+xml;base64";if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(c){c=c.fn.jSignature;c("addPlugin","export","svg",
k);c("addPlugin","export",u,k);c("addPlugin","export","svgbase64",s);c("addPlugin","export",v,s)})($)})();